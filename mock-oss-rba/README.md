# Mock OSS-RBA Service

**Purpose**: Simulates Indonesia's national OSS-RBA (One Single Submission - Risk Based Approach) platform for JELITA integration testing.

## Overview

This mock service implements core OSS-RBA API endpoints to enable integration testing without requiring access to the actual government platform. It simulates realistic response times, data validation, and status progression.

**⚠️ Important**: This is a MOCK service for testing/development purposes only. Real production integration would require:
- Official OSS-RBA API credentials from BKPM
- VPN access to government network
- SSL/TLS certificates
- OAuth2 authentication

## Features

- ✅ Realistic OSS-RBA API endpoint simulation
- ✅ Data validation (NIK, KBLI format checking)
- ✅ Simulated network delays (100-300ms)
- ✅ Automatic NIB (Nomor Induk Berusaha) generation
- ✅ Status progression simulation
- ✅ 95% success rate (5% rejection for testing edge cases)
- ✅ In-memory storage (submissions cleared on restart)

## Installation

```bash
cd mock-oss-rba
npm install
```

## Usage

### Start Server

```bash
npm start
```

Server will run on `http://localhost:4000` (configurable via PORT env variable).

### Development Mode (with auto-reload)

```bash
npm run dev
```

### Run Tests

```bash
npm test
```

## API Endpoints

### 1. Health Check

```http
GET /health
```

**Response**:
```json
{
  "status": "OK",
  "service": "Mock OSS-RBA",
  "version": "1.0.0",
  "timestamp": "2024-12-19T13:45:00.000Z"
}
```

---

### 2. Submit Licensing Application

```http
POST /api/v1/perizinan/submit
Content-Type: application/json
```

**Request Body**:
```json
{
  "pemohonNama": "John Doe",
  "pemohonNIK": "3201234567890123",
  "pemohonEmail": "john@example.com",
  "pemohonTelepon": "081234567890",
  "usahaNama": "PT Example Corp",
  "usahaAlamat": "Jl. Example No. 123",
  "usahaProvinsi": "DKI Jakarta",
  "usahaKabKota": "Jakarta Selatan",
  "kbliKode": "47911",
  "kbliNama": "Retail Trade",
  "izinJenis": "Izin Usaha Perdagangan",
  "izinDeskripsi": "Perdagangan retail",
  "risikoLevel": "Rendah"
}
```

**Success Response** (201 Created):
```json
{
  "status": "success",
  "message": "Pengajuan berhasil diterima",
  "data": {
    "trackingId": "550e8400-e29b-41d4-a716-446655440000",
    "nib": "1234567890123456",
    "statusPengajuan": "DITERIMA",
    "tanggalPengajuan": "2024-12-19T13:45:00.000Z"
  }
}
```

**Validation Error** (400 Bad Request):
```json
{
  "status": "error",
  "message": "Validation failed",
  "errors": [
    "pemohonNIK must be 16 digits",
    "kbliKode must be 5 digits"
  ]
}
```

---

### 3. Check Submission Status

```http
GET /api/v1/perizinan/status/:trackingId
```

**Response**:
```json
{
  "status": "success",
  "data": {
    "trackingId": "550e8400-e29b-41d4-a716-446655440000",
    "nib": "1234567890123456",
    "statusPengajuan": "SELESAI",
    "tanggalPengajuan": "2024-12-19T13:45:00.000Z",
    "tanggalUpdate": "2024-12-19T13:46:00.000Z",
    "riwayatStatus": [
      {
        "status": "DITERIMA",
        "timestamp": "2024-12-19T13:45:00.000Z",
        "keterangan": "Pengajuan diterima oleh sistem OSS-RBA"
      },
      {
        "status": "SELESAI",
        "timestamp": "2024-12-19T13:46:00.000Z",
        "keterangan": "Perizinan selesai diproses"
      }
    ]
  }
}
```

**Status Values**:
- `DITERIMA`: Application received
- `DIPROSES`: Under review
- `SELESAI`: Completed/approved
- `DITOLAK`: Rejected

---

### 4. Get Submission by NIB

```http
GET /api/v1/perizinan/nib/:nib
```

Returns full submission details for a given NIB.

---

### 5. List All Submissions (Admin)

```http
GET /api/v1/perizinan/list
```

Returns list of all submissions (for testing purposes).

---

### 6. Reset All Data (Testing)

```http
DELETE /api/v1/perizinan/reset
```

Clears all submissions from memory.

---

## Data Format Requirements

### NIK (Nomor Induk Kependudukan)
- Format: 16 digits
- Example: `3201234567890123`

### KBLI (Klasifikasi Baku Lapangan Usaha Indonesia)
- Format: 5 digits
- Example: `47911` (Retail trade)
- Reference: [KBLI 2020 Catalog](https://kbli.kemendag.go.id/)

### NIB (Nomor Induk Berusaha)
- Format: 16 digits
- Automatically generated by the system
- Example: `1234567890123456`

### Risk Levels
- `Rendah`: Low risk
- `Menengah`: Medium risk
- `Tinggi`: High risk

## Simulated Behavior

### Response Times
- **Health check**: Instant
- **Submit/Status check**: 100-300ms (random delay)

### Success Rates
- **95% approval**: Most submissions are automatically approved
- **5% rejection**: Random rejections for testing error handling

### Status Progression
Submissions automatically progress through statuses:
1. **DITERIMA** (immediately on submission)
2. **SELESAI** (after 30 seconds)

This simulates the real OSS-RBA workflow where approvals take minutes to hours.

## Integration Example

```javascript
// Example: Submit application from JELITA
const submitToOSS = async (applicationData) => {
  try {
    const response = await fetch('http://localhost:4000/api/v1/perizinan/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        pemohonNama: applicationData.pemohonNama,
        pemohonNIK: applicationData.pemohonNIK,
        // ... other fields
      })
    });
    
    const result = await response.json();
    
    if (result.status === 'success') {
      // Store trackingId and NIB in JELITA database
      console.log('✅ Submitted to OSS-RBA:', result.data.trackingId);
      return result.data;
    } else {
      console.error('❌ Submission failed:', result.message);
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('❌ Network error:', error);
    throw error;
  }
};

// Example: Check status
const checkStatus = async (trackingId) => {
  const response = await fetch(`http://localhost:4000/api/v1/perizinan/status/${trackingId}`);
  const result = await response.json();
  return result.data;
};
```

## Environment Variables

```bash
PORT=4000              # Server port (default: 4000)
NODE_ENV=development   # Environment (development/production)
```

## Testing Checklist

When testing JELITA integration with this mock:

- [ ] Submit application with valid data (expect success)
- [ ] Submit with invalid NIK format (expect validation error)
- [ ] Submit with invalid KBLI format (expect validation error)
- [ ] Submit with missing required fields (expect validation error)
- [ ] Check status immediately after submission (expect DITERIMA)
- [ ] Wait 30+ seconds and check status again (expect SELESAI)
- [ ] Test with non-existent trackingId (expect 404)
- [ ] Test network timeout scenarios
- [ ] Test high-load scenarios (multiple concurrent submissions)

## Architecture Notes

This mock service addresses **Publisher Issue #2**:

> "The paper claims integration with OSS-RBA but did not conduct any integration tests with actual national platforms."

**Solution**:
1. ✅ Mock service implements OSS-RBA API specification
2. ✅ JELITA API Gateway integrates with this mock
3. ✅ Integration tests validate data flow and error handling
4. ✅ Paper documents mock approach with clear disclaimer

**Paper Documentation**:
- Section 4.5: "OSS-RBA Integration Architecture (Mock Implementation)"
- Section 5.4: "Integration Testing Results"
- Appendix B: "OSS-RBA API Specification and Mock Design"

**Disclaimer for Paper**:
> This thesis uses a mock OSS-RBA service for integration testing due to access restrictions to the actual government platform. The mock service implements the official OSS-RBA API specification as documented in BKPM technical guidelines. Real production deployment would require formal API credentials and VPN access to the national OSS-RBA system.

## Troubleshooting

**Port already in use**:
```bash
# Windows
netstat -ano | findstr :4000
taskkill /PID <pid> /F

# Change port
set PORT=4001 && npm start
```

**Submissions not persisting**:
- This is expected behavior (in-memory storage)
- For persistent storage, add database integration

**Status not progressing**:
- Check server time (status progresses after 30 seconds)
- Ensure single server instance running

## License

MIT License - For testing/educational purposes only

---

**Last Updated**: December 19, 2024  
**Version**: 1.0.0
